<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Turn a PLOS search into a visualization</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="//code.jquery.com/jquery-1.10.2.js"></script>
        <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
        <!--<script type="text/javascript" src="vis/lib/jquery-1.8.1.min.js"></script>-->
        <script type="text/javascript" src="vis/lib/d3.v3.js"></script>
        <script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.14.0/jquery.validate.min.js"></script>
        <link rel="stylesheet" type="text/css" href="vis/style.css"/>
        <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    </head>
    <body>
        <div>
            <form id="searchform" action="server/services/searchPLOS.php">
                <label for="q">Search term:</label> 
                <input type="text" name="q" required><br>
                <button type="submit" class="btn">Submit</button>
            </form> 
        </div>

        <div id="progress"></div>

        <script type="text/javascript">
            $("#searchform").validate({
                submitHandler: function (form) {
                    $(".btn").attr("disabled", true);
                    
                
                    d3.select("#progress").append("p")
                        .text("Please be patient, this can take a while...")
                        .append("div")
                        .attr("id", "progressbar")
                
                    $("#progressbar").progressbar();
                    var tick_interval = 2;
                    var tick_increment = 1;
                    var tick_function = function () {
                        var value = $("#progressbar").progressbar("option", "value");
                        value += tick_increment;
                        $("#progressbar").progressbar("option", "value", value);
                        if (value < 100) {
                            window.setTimeout(tick_function, tick_interval * 1000);
                        } else {
                            //alert("Done");
                        }
                    };
                    window.setTimeout(tick_function, tick_interval * 1000);
                    
                    form.submit();
                }
            });

        </script>
    </body>
</html>
